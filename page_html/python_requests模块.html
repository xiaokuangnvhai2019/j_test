<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin">
    
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>小戳同学 - 博客园</title>
    
    <link rel="stylesheet" href="https://www.cnblogs.com/css/blog-common.min.css?v=sqi5FxOybx6gjGoG6Zfy1wD-0AwznLNLYOVx7Y9tIN0">
    <link id="MainCss" rel="stylesheet" href="https://www.cnblogs.com/skins/coffee/bundle-coffee.min.css?v=pdMIVgsH8kXt-vOWnlL0N20TlHt3UyP9HzGgocfsP4s">
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="https://www.cnblogs.com/skins/coffee/bundle-coffee-mobile.min.css?v=MGucLWekW6t3A88Ks-YfEzrx4X_hEIpMacbOAC9lJUs">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/xiaokuangnvhai/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/xiaokuangnvhai/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/xiaokuangnvhai/wlwmanifest.xml">
    <script async="" src="https://www.google-analytics.com/analytics.js"></script><script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="https://www.cnblogs.com/js/blog-common.min.js?v=ruOFvx8_pDlyiWjHGHyOXclVmNo396_IKB8YFZjMllo"></script>
    <script>
        var currentBlogId = 516754;
        var currentBlogApp = 'xiaokuangnvhai';
        var cb_enable_mathjax = false;
        var isLogined = true;
    </script>  
</head><h1 class='postTitle'><a class="postTitle2" href="https://www.cnblogs.com/xiaokuangnvhai/p/11120689.html" id="cb_post_title_url">python_requests模块</a></h1<div class='postBody'><div class="blogpost-body" id="cnblogs_post_body">
<p>1、安装</p>
<div class="cnblogs_code">
<pre>pip install requests</pre>
</div>
<p>2、get请求</p>
<p>如果需要加cookie可以直接加在headers中</p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests
</span><span style="color: #008000;">#</span><span style="color: #008000;">get请求带参数</span>
url=<span style="color: #800000;">"</span><span style="color: #800000;">http://xxx/api/user/stu_info</span><span style="color: #800000;">"</span><span style="color: #000000;">
data</span>={<span style="color: #800000;">"</span><span style="color: #800000;">stu_name</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">矿泉水1</span><span style="color: #800000;">"</span><span style="color: #000000;">}
result</span>=<span style="color: #000000;">requests.get(url,data)
</span><span style="color: #0000ff;">print</span>(result.json()) <span style="color: #008000;">#</span><span style="color: #008000;">返回字典类型</span>
<span style="color: #0000ff;">print</span>(result.text) <span style="color: #008000;">#</span><span style="color: #008000;">返回一个字符串类型</span>
<span style="color: #0000ff;">print</span>(result.content) <span style="color: #008000;">#</span><span style="color: #008000;">返回bytes类型</span>

<span style="color: #008000;">#</span><span style="color: #008000;">get请求无参数</span>
url2=<span style="color: #800000;">'</span><span style="color: #800000;">http://q4.qlogo.cn/g?b=qq&amp;nk=xxx&amp;s=140</span><span style="color: #800000;">'</span><span style="color: #000000;">
result2</span>=<span style="color: #000000;">requests.get(url2)
fw</span>=open(<span style="color: #800000;">"</span><span style="color: #800000;">jjj.png</span><span style="color: #800000;">"</span>,<span style="color: #800000;">'</span><span style="color: #800000;">wb</span><span style="color: #800000;">'</span>) <span style="color: #008000;">#</span><span style="color: #008000;">get请求结果写入文件</span>
<span style="color: #000000;">fw.write(result2.content)
fw.close()</span></pre>
</div>
<p> 3、post 请求</p>
<p> </p>
<div class="cnblogs_code">
<pre><span style="color: #000000;">1、传入xml格式文本

requests.post(url</span>=<span style="color: #800000;">''</span>,data=<span style="color: #800000;">'</span><span style="color: #800000;">&lt;?xml  ?&gt;</span><span style="color: #800000;">'</span>,headers={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">text/xml</span><span style="color: #800000;">'</span><span style="color: #000000;">})



2、传入json格式文本

requests.post(url</span>=<span style="color: #800000;">''</span>,data=json.dumps({<span style="color: #800000;">'</span><span style="color: #800000;">key1</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value1</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">key2</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value2</span><span style="color: #800000;">'</span>}),headers={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">application/json</span><span style="color: #800000;">'</span><span style="color: #000000;">})

或者：

requests.post(url</span>=<span style="color: #800000;">''</span>,json={{<span style="color: #800000;">'</span><span style="color: #800000;">key1</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value1</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">key2</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value2</span><span style="color: #800000;">'</span>}},headers={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">application/json</span><span style="color: #800000;">'</span><span style="color: #000000;">}


3、请求正文是multipart</span>/form-<span style="color: #000000;">data

除了传统的application</span>/x-www-form-urlencoded表单，我们另一个经常用到的是上传文件用的表单，这种表单的类型为multipart/form-<span style="color: #000000;">data

requests.post(url</span>=<span style="color: #800000;">''</span>,data={<span style="color: #800000;">'</span><span style="color: #800000;">key1</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value1</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">key2</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value2</span><span style="color: #800000;">'</span>},headers={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">multipart/form-data</span><span style="color: #800000;">'</span><span style="color: #000000;">})

4、请求正文是application</span>/x-www-form-<span style="color: #000000;">urlencoded<br/>
默认就是这种，可以不标注headers的值
requests.post(url</span>=<span style="color: #800000;">''</span>,data={<span style="color: #800000;">'</span><span style="color: #800000;">key1</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value1</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">key2</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">value2</span><span style="color: #800000;">'</span>},headers={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">application/x-www-form-urlencoded</span><span style="color: #800000;">'</span>})</pre>
</div>
<p> </p>
<div class="cnblogs_code">
<pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> requests

</span><span style="color: #008000;">#</span><span style="color: #008000;">application/x-www-form-urlencoded格式</span>
url=<span style="color: #800000;">'</span><span style="color: #800000;">http://xxx/api/user/login</span><span style="color: #800000;">'</span> <span style="color: #008000;">#</span><span style="color: #008000;">地址</span>
data={<span style="color: #800000;">'</span><span style="color: #800000;">username</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">niuhanyang</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">passwd</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">aA123456</span><span style="color: #800000;">'</span>} <span style="color: #008000;">#</span><span style="color: #008000;">传参</span>
result=requests.post(url,data) <span style="color: #008000;">#</span><span style="color: #008000;">发送POST请求</span>
<span style="color: #0000ff;">print</span>(result.text) <span style="color: #008000;">#</span><span style="color: #008000;">打印结果</span>

<span style="color: #008000;">#</span><span style="color: #008000;">application/json 格式</span>
url4=<span style="color: #800000;">"</span><span style="color: #800000;">http://xxx/api/user/add_stu</span><span style="color: #800000;">"</span><span style="color: #000000;">
header2</span>={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">application/json</span><span style="color: #800000;">'</span>} <span style="color: #008000;">#
</span>data=<span style="color: #000000;">{
        </span><span style="color: #800000;">"</span><span style="color: #800000;">name</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">小黑324</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">grade</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">天蝎座</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">phone</span><span style="color: #800000;">"</span>:13512532945<span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">sex</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">男</span><span style="color: #800000;">"</span><span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">age</span><span style="color: #800000;">"</span>:28<span style="color: #000000;">,
        </span><span style="color: #800000;">"</span><span style="color: #800000;">addr</span><span style="color: #800000;">"</span>:<span style="color: #800000;">"</span><span style="color: #800000;">河南省济源市北海大道32号</span><span style="color: #800000;">"</span><span style="color: #000000;">
      }
result4</span>=requests.post(url4,json=data,headers=<span style="color: #000000;">header2)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(result4.text)

</span><span style="color: #008000;">#</span><span style="color: #008000;">application/soap+xml 格式</span>
url2=<span style="color: #800000;">"</span><span style="color: #800000;">http://www.webxml.com.cn/WebServices/WeatherWebService.asmx</span><span style="color: #800000;">"</span><span style="color: #000000;">
header</span>={<span style="color: #800000;">'</span><span style="color: #800000;">Content-Type</span><span style="color: #800000;">'</span>:<span style="color: #800000;">'</span><span style="color: #800000;">application/soap+xml</span><span style="color: #800000;">'</span>} <span style="color: #008000;">#
</span>data=r<span style="color: #800000;">'''</span><span style="color: #800000;">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;soap12:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
xmlns:soap12="http://www.w3.org/2003/05/soap-envelope"&gt;&lt;soap12:Body&gt;&lt;getWeatherbyCityName xmlns="http://WebXml.com.cn/"&gt;
&lt;theCityName&gt;北京&lt;/theCityName&gt;&lt;/getWeatherbyCityName&gt;&lt;/soap12:Body&gt;&lt;/soap12:Envelope&gt;</span><span style="color: #800000;">'''</span><span style="color: #000000;">
result2</span>=requests.post(url2,data=data.encode(<span style="color: #800000;">'</span><span style="color: #800000;">utf-8</span><span style="color: #800000;">'</span>),headers=<span style="color: #000000;">header)
</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(result2.text)


</span><span style="color: #008000;">#</span><span style="color: #008000;">上传文件</span>
url3=<span style="color: #800000;">'</span><span style="color: #800000;">http://xxx/api/file/file_upload</span><span style="color: #800000;">'</span><span style="color: #000000;">
result3</span>=requests.post(url3,files={<span style="color: #800000;">'</span><span style="color: #800000;">file</span><span style="color: #800000;">'</span>:open(<span style="color: #800000;">'</span><span style="color: #800000;">x.jpg</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">rb</span><span style="color: #800000;">'</span>)}) <span style="color: #008000;">#</span><span style="color: #008000;">上传文件需要用二进制方式进行打开</span>
<span style="color: #0000ff;">print</span>(result3.text)</pre>
</div>
<p> </p>
</div></div>